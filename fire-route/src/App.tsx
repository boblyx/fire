/**
 * App.tsx
 * Renders the whole app.
 * TODO:
 * 
 * @author Bob YX Lee
 */

import { onCleanup, onMount } from 'solid-js';
import type { Component } from 'solid-js';
import * as bootstrap from 'bootstrap';
import {SVG} from '@svgdotjs/svg.js';
import { getPathsFromStr, findMats, Mat, traverseEdges, toScaleAxis } from 'flo-mat';
import { drawMats } from './MAT';

let svg_canvas : HTMLDivElement;

function sample(){
  let draw = SVG()
  draw.viewbox(0,0, 900, 500);
  draw.addTo('#svg-canvas');
  let path_str = `
    M-84.62937424963717,-33.519280171492795 L-153.12937424963707,-33.51928017149302 L-153.12937424963707,-12.519280171493016 L-84.62937424963708,-12.519280171492793 L-84.62937424963708,50.980719828507205 L-64.62937424963695,50.980719828507205 L-64.62937424963695,47.105719828507155 L-61.62937424963696,47.105719828507155 L-61.62937424963696,50.980719828507205 L-18.129374249636978,50.980719828507205 L-18.129374249636978,47.105719828507006 L-15.129374249636978,47.105719828507006 L-15.129374249636978,50.980719828507205 L-13.129374249637065,50.980719828507205 L-13.129374249637065,110.48071982850725 L15.870625750362935,110.48071982850725 L15.870625750363033,50.980719828507205 L28.370625750363025,50.980719828507205 L28.370625750363025,47.105719828507155 L31.370625750363025,47.105719828507155 L31.370625750363025,50.980719828507205 L62.370625750363025,50.980719828507205 L62.370625750363025,-73.01928017149278 L31.370625750363057,-73.01928017149288 L31.370625750363057,-69.26928017149288 L28.370625750363057,-69.26928017149288 L28.370625750363057,-73.01928017149288 L-15.129374249636946,-73.01928017149302 L-15.129374249636946,-69.26928017149302 L-18.129374249636946,-69.26928017149302 L-18.129374249636946,-73.01928017149304 L-61.62937424963694,-73.01928017149318 L-61.62937424963694,-69.26928017149288 L-64.62937424963694,-69.26928017149288 L-64.62937424963694,-73.0192801714932 L-84.6293742496371,-73.01928017149325 M-61.62937424963696,7.064053161840487 L-61.62937424963696,10.81405316184048 L-64.62937424963695,10.81405316184048 L-64.62937424963695,7.064053161840487 M-61.629374249637024,-32.97761350482619 L-61.629374249637024,-29.227613504826195 L-64.62937424963702,-29.227613504826195 L-64.62937424963702,-32.97761350482619 M-15.129374249636978,7.064053161840335 L-15.129374249636978,10.814053161840327 L-18.129374249636978,10.814053161840327 L-18.129374249636978,7.064053161840335 M-15.129374249637033,-32.97761350482634 L-15.129374249637033,-29.22761350482635 L-18.12937424963703,-29.22761350482635 L-18.12937424963703,-32.97761350482634 M31.370625750363025,7.064053161840487 L31.370625750363025,10.81405316184048 L28.370625750363025,10.81405316184048 L28.370625750363025,7.064053161840487 M31.37062575036297,-32.97761350482619 L31.37062575036297,-29.227613504826195 L28.37062575036297,-29.227613504826195 L28.37062575036297,-32.97761350482619
	`
  
  /*
  path_str = `
        M 144 251
        C 145 169 110 82 227 59 
        C 344 36 429 -46 505 96 
        C 581 238 696 407 554 435 
        C 412 463 191 532 197 442 
        C 203 352 213 363 276 346 
        C 339 329 563 318 437 242 
        C 311 166 302 181 297 314 
        C 292 447 160 585 151 419 
        C 142 253 87.12 312.78 86 314 
        C 87.16 312.74 142.8632 252.2348 144 251 
        z
  `*/
  draw.path(path_str)
  //let rect = draw.rect(100,100).attr({fill:'#f06'});
  let svg = draw.node;
  let path = draw.node.children[0];
  path.classList.add('shape-path');
  console.log(draw.node.children[0]);
  let bezier_loops = getPathsFromStr(path_str);
  let mats = findMats(bezier_loops, 3);
  let sats = mats.map(mat => toScaleAxis(mat, 3));
  //drawMats(mats, svg, 'mat');
  drawMats(sats, svg, 'sat');
}

const App: Component = () => {

  onMount(()=>{
    sample();
  });

  let r = (
    <>
      <div class="m-4">
      <h1>hrchk</h1>
      <div>
        <button type="button" class="btn btn-primary">Upload Floor Representation</button>
      </div>
      <hr/>
        <div ref = {svg_canvas} id = "svg-canvas" style="width: 600px; height:500px"></div>
      </div>
    </>
  )

  return r;

};

export default App;
